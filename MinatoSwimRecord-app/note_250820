# ğŸŠâ€â™‚ï¸ ç«¶æ³³ç›®æ¨™å€¤ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å®Ÿè£…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

## ğŸ“‹ **å®Ÿè£…è¦æ±‚**

æ—¢å­˜ã®ç«¶æ³³ã‚¢ãƒ—ãƒªã«ã€**ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆã‚’å®Œå…¨å›é¿**ã—ãªãŒã‚‰ç›®æ¨™åŸºæº–ç·šæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

### ğŸ—‚ï¸ **æ–°è¦ä½œæˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **
```
ç¾åœ¨ã®æ§‹é€ ï¼š
.
â”œâ”€â”€ data/              # æ—¢å­˜ï¼ˆè§¦ã‚‰ãªã„ï¼‰
â””â”€â”€ node_modules/      # æ—¢å­˜

è¿½åŠ ã™ã‚‹æ§‹é€ ï¼š
.
â”œâ”€â”€ data/              # æ—¢å­˜ï¼ˆå¤‰æ›´ãªã—ï¼‰
â”œâ”€â”€ node_modules/      # æ—¢å­˜
â””â”€â”€ targets/           # ğŸ†• æ–°è¦ä½œæˆ
    â”œâ”€â”€ swimming_targets.csv
    â””â”€â”€ README.md
```

## ğŸ”§ **Phase 1: ç›®æ¨™ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆClaude Codeï¼‰**

ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‹ã‚‰æœ€æ–°ã®ç«¶æ³³ç›®æ¨™ã‚¿ã‚¤ãƒ ã‚’æŠ½å‡ºã—ã¦ã€æ–°è¦CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

### **ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**
- https://ja.wikipedia.org/wiki/ç«¶æ³³ã®æ—¥æœ¬ä¸­å­¦è¨˜éŒ²ä¸€è¦§
- https://ja.wikipedia.org/wiki/å…¨å›½JOCã‚¸ãƒ¥ãƒ‹ã‚¢ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ã‚«ãƒƒãƒ—æ°´æ³³ç«¶æŠ€å¤§ä¼šè¨˜éŒ²  
- https://swim.seiko.co.jp/ï¼ˆæœ€æ–°å¤§ä¼šãƒ‡ãƒ¼ã‚¿ï¼‰

### **CSVãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ**
**ãƒ•ã‚¡ã‚¤ãƒ«å**: `targets/swimming_targets.csv`

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **:
```csv
age,event,distance,pool_type,meet,level,time_seconds,time_display,last_updated
13,freestyle,50,short,zenchu,champion,23.50,23.50,2024-08-17
13,freestyle,50,short,zenchu,final,24.20,24.20,2024-08-17
13,freestyle,50,short,zenchu,standard,25.20,25.20,2024-08-17
13,freestyle,50,long,zenchu,champion,24.00,24.00,2024-08-17
13,freestyle,100,short,zenchu,champion,50.80,50.80,2024-08-17
13,butterfly,50,short,jo_summer,champion,24.80,24.80,2024-08-22
13,butterfly,100,short,jo_summer,champion,55.80,55.80,2024-08-22
13,butterfly,200,short,jo_spring,champion,135.00,2:15.00,2024-03-28
14,freestyle,50,short,zenchu,champion,23.20,23.20,2024-08-17
15,freestyle,50,short,zenchu,champion,22.90,22.90,2024-08-17
```

**å¯¾è±¡ç¯„å›²**:
- **å¹´é½¢**: 13æ­³ã€14æ­³ã€15æ­³
- **ç¨®ç›®**: freestyle, butterfly  
- **è·é›¢**: 50, 100, 200
- **ãƒ—ãƒ¼ãƒ«**: short(25m), long(50m)
- **å¤§ä¼š**: zenchu(å…¨ä¸­), jo_summer(JOå¤), jo_spring(JOæ˜¥)
- **ãƒ¬ãƒ™ãƒ«**: champion(å„ªå‹), final(æ±ºå‹), standard(æ¨™æº–è¨˜éŒ²)

---

## ğŸš€ **Phase 2: ã‚¢ãƒ—ãƒªæ©Ÿèƒ½è¿½åŠ ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«éç ´å£Šï¼‰**

### **æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ: `target-manager.js`**

```javascript
// targets/target-manager.js
class TargetManager {
  constructor() {
    this.birthDate = "2012-09-04"; // YYYY-MM-DD
    this.fallbackData = this.getFallbackTargets();
    this.targetData = null;
  }

  // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
  getFallbackTargets() {
    return {
      13: {
        freestyle: {
          50: {
            short: { zenchu: {champion: 23.50, final: 24.20, standard: 25.20} },
            long: { zenchu: {champion: 24.00, final: 24.70, standard: 25.70} }
          },
          100: {
            short: { zenchu: {champion: 50.80, final: 53.00, standard: 55.50} },
            long: { zenchu: {champion: 52.00, final: 54.50, standard: 57.00} }
          }
        },
        butterfly: {
          50: {
            short: { zenchu: {champion: 25.20, final: 26.50, standard: 28.00} },
            long: { zenchu: {champion: 25.70, final: 27.00, standard: 28.50} }
          },
          100: {
            short: { zenchu: {champion: 56.50, final: 59.00, standard: 62.00} },
            long: { zenchu: {champion: 58.00, final: 60.50, standard: 63.50} }
          }
        }
      },
      14: { /* 14æ­³ãƒ‡ãƒ¼ã‚¿ */ },
      15: { /* 15æ­³ãƒ‡ãƒ¼ã‚¿ */ }
    };
  }

  // å¹´é½¢è¨ˆç®—
  calculateAge() {
    const today = new Date();
    const birth = new Date(this.birthDate);
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
      age--;
    }
    return age;
  }

  // CSVãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ï¼‰
  async initializeTargets() {
    try {
      console.log('æœ€æ–°ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...');
      const response = await fetch('./targets/swimming_targets.csv');
      const csvText = await response.text();
      this.targetData = this.parseCSV(csvText);
      console.log('æœ€æ–°ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ');
      return this.targetData;
    } catch (error) {
      console.log('æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨:', error);
      this.targetData = this.fallbackData;
      return this.fallbackData;
    }
  }

  // CSVè§£æ
  parseCSV(csvText) {
    const lines = csvText.split('\n');
    const headers = lines[0].split(',');
    const data = {};
    
    for (let i = 1; i < lines.length; i++) {
      if (lines[i].trim()) {
        const values = lines[i].split(',');
        const row = {};
        headers.forEach((header, index) => {
          row[header.trim()] = values[index]?.trim();
        });
        
        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ åŒ–
        const age = parseInt(row.age);
        if (!data[age]) data[age] = {};
        // ä»¥ä¸‹ã€éšå±¤æ§‹é€ ä½œæˆ...
      }
    }
    return data;
  }

  // ç›®æ¨™åŸºæº–ç·šå–å¾—
  getTargetLines(event, distance, poolType) {
    const currentAge = this.calculateAge();
    const ageData = this.targetData?.[currentAge] || this.fallbackData[currentAge];
    
    if (!ageData?.[event]?.[distance]?.[poolType]) {
      return [];
    }

    const targets = [];
    const eventData = ageData[event][distance][poolType];
    
    Object.entries(eventData).forEach(([meet, levels]) => {
      Object.entries(levels).forEach(([level, time]) => {
        targets.push({
          meet,
          level, 
          time: parseFloat(time),
          label: `${meet}_${level}`,
          color: this.getLineColor(meet, level),
          style: this.getLineStyle(level)
        });
      });
    });

    return targets;
  }

  // ç·šã®è‰²ã¨ã‚¹ã‚¿ã‚¤ãƒ«
  getLineColor(meet, level) {
    const meetColors = {
      zenchu: '#FF6B6B',
      jo_summer: '#4ECDC4', 
      jo_spring: '#45B7D1'
    };
    return meetColors[meet] || '#999999';
  }

  getLineStyle(level) {
    const styles = {
      champion: { lineStyle: 'solid', width: 2, opacity: 0.8 },
      final: { lineStyle: 'dashed', width: 1.5, opacity: 0.7 },
      standard: { lineStyle: 'dotted', width: 1, opacity: 0.6 }
    };
    return styles[level] || styles.standard;
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
window.targetManager = new TargetManager();
```

### **æ—¢å­˜HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®è¿½åŠ **

æ—¢å­˜ã® `index.html` ã® `<head>` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```html
<!-- ç›®æ¨™ç®¡ç†æ©Ÿèƒ½ -->
<script src="./targets/target-manager.js"></script>
```

### **æ—¢å­˜JSãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®çµ±åˆ**

æ—¢å­˜ã®ã‚°ãƒ©ãƒ•æç”»é–¢æ•°ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã—ãªã„ï¼‰:

```javascript
// æ—¢å­˜ã®ã‚°ãƒ©ãƒ•åˆæœŸåŒ–å¾Œã«è¿½åŠ 
async function addTargetLines() {
  // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
  await window.targetManager.initializeTargets();
  
  // ç¾åœ¨é¸æŠä¸­ã®ç¨®ç›®ãƒ»è·é›¢ãƒ»ãƒ—ãƒ¼ãƒ«æƒ…å ±å–å¾—
  const selectedEvent = getCurrentEvent();     // æ—¢å­˜é–¢æ•°
  const selectedDistance = getCurrentDistance(); // æ—¢å­˜é–¢æ•°  
  const selectedPool = getCurrentPool();       // æ—¢å­˜é–¢æ•°
  
  // ç›®æ¨™åŸºæº–ç·šå–å¾—
  const targetLines = window.targetManager.getTargetLines(
    selectedEvent, 
    selectedDistance, 
    selectedPool
  );
  
  // ã‚°ãƒ©ãƒ•ã«åŸºæº–ç·šè¿½åŠ 
  targetLines.forEach(target => {
    addHorizontalLineToChart(chart, {
      value: target.time,
      label: target.label,
      color: target.color,
      style: target.style
    });
  });
}

// ç¨®ç›®ãƒ»ãƒ—ãƒ¼ãƒ«å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã«è¿½åŠ 
document.getElementById('event-selector').addEventListener('change', () => {
  updateChart(); // æ—¢å­˜é–¢æ•°
  addTargetLines(); // æ–°è¦è¿½åŠ 
});
```

## ğŸ“¦ **æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**

```
.
â”œâ”€â”€ data/                    # æ—¢å­˜ï¼ˆå¤‰æ›´ãªã—ï¼‰
â”œâ”€â”€ node_modules/            # æ—¢å­˜
â”œâ”€â”€ targets/                 # ğŸ†• æ–°è¦ä½œæˆ
â”‚   â”œâ”€â”€ swimming_targets.csv # ğŸ†• ç›®æ¨™ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ target-manager.js    # ğŸ†• ç®¡ç†ã‚¯ãƒ©ã‚¹
â”‚   â””â”€â”€ README.md           # ğŸ†• æ›´æ–°æ‰‹é †
â”œâ”€â”€ index.html              # ğŸ”§ <script>ã‚¿ã‚°1è¡Œè¿½åŠ ã®ã¿
â””â”€â”€ [æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤]         # ğŸ›¡ï¸ æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿æŒ
```

## âœ… **å®‰å…¨æ€§ç¢ºèª**

- âœ… æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¸€åˆ‡è§¦ã‚‰ãªã„
- âœ… æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸Šæ›¸ããªã—
- âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œä¿è¨¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- âœ… å¹´é½¢è‡ªå‹•è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥å¯¾å¿œï¼‰
- âœ… æ®µéšçš„å®Ÿè£…å¯èƒ½

ã“ã®å®Ÿè£…ã§ã€**æ—¢å­˜æ©Ÿèƒ½ã‚’ä¸€åˆ‡ç ´å£Šã›ãš**ã«ç›®æ¨™åŸºæº–ç·šæ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã¾ã™ï¼
